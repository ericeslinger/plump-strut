"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var authentication_channel_1 = require("./authentication.channel");
function singletonDispatch(handler, msg, strut) {
    return handler(msg, strut).then(function (r) {
        msg.client.emit(msg.responseKey, r);
    });
}
function dispatch(s) {
    s.io.on('connection', function (client) {
        client.on('auth', function (msg) {
            var request = Object.assign({}, msg, { client: client });
            singletonDispatch(authentication_channel_1.dispatch, request, s);
        });
    });
}
exports.dispatch = dispatch;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zb2NrZXQvY2hhbm5lbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFPQSxtRUFBbUU7QUFFbkUsMkJBQ0UsT0FBdUIsRUFDdkIsR0FBc0MsRUFDdEMsS0FBa0I7SUFFbEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQztRQUMvQixHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELGtCQUF5QixDQUFjO0lBQ3JDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxVQUFBLE1BQU07UUFDMUIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsVUFBQSxHQUFHO1lBQ25CLElBQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzNELGlCQUFpQixDQUFDLGlDQUFXLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBUEQsNEJBT0MiLCJmaWxlIjoic29ja2V0L2NoYW5uZWxzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgU29ja2V0SU8gZnJvbSAnc29ja2V0LmlvJztcbmltcG9ydCB7IFN0cnV0U2VydmVyIH0gZnJvbSAnLi4vaW5kZXgnO1xuaW1wb3J0IHtcbiAgU2luZ2xldG9uUmVxdWVzdCxcbiAgUmVxdWVzdEhhbmRsZXIsXG4gIENoYW5uZWxSZXF1ZXN0LFxufSBmcm9tICcuL21lc3NhZ2VJbnRlcmZhY2VzJztcbmltcG9ydCB7IGRpc3BhdGNoIGFzIGF1dGhDaGFubmVsIH0gZnJvbSAnLi9hdXRoZW50aWNhdGlvbi5jaGFubmVsJztcblxuZnVuY3Rpb24gc2luZ2xldG9uRGlzcGF0Y2goXG4gIGhhbmRsZXI6IFJlcXVlc3RIYW5kbGVyLFxuICBtc2c6IFNpbmdsZXRvblJlcXVlc3QgJiBDaGFubmVsUmVxdWVzdCxcbiAgc3RydXQ6IFN0cnV0U2VydmVyLFxuKSB7XG4gIHJldHVybiBoYW5kbGVyKG1zZywgc3RydXQpLnRoZW4ociA9PiB7XG4gICAgbXNnLmNsaWVudC5lbWl0KG1zZy5yZXNwb25zZUtleSwgcik7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGlzcGF0Y2goczogU3RydXRTZXJ2ZXIpIHtcbiAgcy5pby5vbignY29ubmVjdGlvbicsIGNsaWVudCA9PiB7XG4gICAgY2xpZW50Lm9uKCdhdXRoJywgbXNnID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBPYmplY3QuYXNzaWduKHt9LCBtc2csIHsgY2xpZW50OiBjbGllbnQgfSk7XG4gICAgICBzaW5nbGV0b25EaXNwYXRjaChhdXRoQ2hhbm5lbCwgcmVxdWVzdCwgcyk7XG4gICAgfSk7XG4gIH0pO1xufVxuIl19
