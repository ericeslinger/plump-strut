"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var authentication_channel_1 = require("./authentication.channel");
function singletonDispatch(handler, msg, strut) {
    return handler(msg, strut).then(function (r) {
        msg.client.emit(msg.responseKey, r);
    });
}
function dispatch(s) {
    s.services.io.on('connection', function (client) {
        client.on('auth', function (msg) {
            var request = Object.assign({}, msg, { client: client });
            singletonDispatch(authentication_channel_1.authenticationChannelDispatch, request, s);
        });
    });
}
exports.dispatch = dispatch;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zb2NrZXQuY2hhbm5lbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQU9BLG1FQUF3RjtBQUV4RiwyQkFDRSxPQUF1QixFQUN2QixHQUFzQyxFQUN0QyxLQUFrQjtJQUVsQixNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxDQUFDO1FBQy9CLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsa0JBQXlCLENBQWM7SUFDckMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxVQUFBLE1BQU07UUFDbkMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsVUFBQSxHQUFHO1lBQ25CLElBQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzNELGlCQUFpQixDQUFDLHNEQUFXLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBUEQsNEJBT0MiLCJmaWxlIjoic29ja2V0LmNoYW5uZWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBTb2NrZXRJTyBmcm9tICdzb2NrZXQuaW8nO1xuaW1wb3J0IHtcbiAgUmVxdWVzdEhhbmRsZXIsXG4gIFN0cnV0U2VydmVyLFxuICBTaW5nbGV0b25SZXF1ZXN0LFxuICBDaGFubmVsUmVxdWVzdCxcbn0gZnJvbSAnLi9kYXRhVHlwZXMnO1xuaW1wb3J0IHsgYXV0aGVudGljYXRpb25DaGFubmVsRGlzcGF0Y2ggYXMgYXV0aENoYW5uZWwgfSBmcm9tICcuL2F1dGhlbnRpY2F0aW9uLmNoYW5uZWwnO1xuXG5mdW5jdGlvbiBzaW5nbGV0b25EaXNwYXRjaChcbiAgaGFuZGxlcjogUmVxdWVzdEhhbmRsZXIsXG4gIG1zZzogU2luZ2xldG9uUmVxdWVzdCAmIENoYW5uZWxSZXF1ZXN0LFxuICBzdHJ1dDogU3RydXRTZXJ2ZXIsXG4pIHtcbiAgcmV0dXJuIGhhbmRsZXIobXNnLCBzdHJ1dCkudGhlbihyID0+IHtcbiAgICBtc2cuY2xpZW50LmVtaXQobXNnLnJlc3BvbnNlS2V5LCByKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkaXNwYXRjaChzOiBTdHJ1dFNlcnZlcikge1xuICBzLnNlcnZpY2VzLmlvLm9uKCdjb25uZWN0aW9uJywgY2xpZW50ID0+IHtcbiAgICBjbGllbnQub24oJ2F1dGgnLCBtc2cgPT4ge1xuICAgICAgY29uc3QgcmVxdWVzdCA9IE9iamVjdC5hc3NpZ24oe30sIG1zZywgeyBjbGllbnQ6IGNsaWVudCB9KTtcbiAgICAgIHNpbmdsZXRvbkRpc3BhdGNoKGF1dGhDaGFubmVsLCByZXF1ZXN0LCBzKTtcbiAgICB9KTtcbiAgfSk7XG59XG4iXX0=
