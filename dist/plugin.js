"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function compose() {
    var funs = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        funs[_i] = arguments[_i];
    }
    return function (initial) {
        if (initial === void 0) { initial = {}; }
        return funs.reduce(function (acc, v) { return v(acc); }, initial);
    };
}
function plugin(gen, routeOptions, services) {
    function p(server, _, next) {
        var routes = [];
        ['create', 'read', 'update', 'delete', 'query'].forEach(function (action) {
            var o = Object.assign({}, routeOptions, {
                kind: 'attributes',
                action: action,
            });
            routes.push(compose(gen.base(o, services), gen.joi(o, services), gen.authorize(o, services), gen.handle(o, services))());
        });
        Object.keys(routeOptions.model.schema.relationships).forEach(function (relationship) {
            ['create', 'read', 'update', 'delete'].forEach(function (action) {
                var o = Object.assign({}, routeOptions, {
                    kind: 'relationship',
                    action: action,
                    relationship: relationship,
                });
                routes.push(compose(gen.base(o, services), gen.joi(o, services), gen.authorize(o, services), gen.handle(o, services))());
            });
        });
        server.route(routes);
        next();
    }
    p['attributes'] = Object.assign({}, {
        version: '1.0.0',
        name: routeOptions.model.type,
    });
    return p;
}
exports.plugin = plugin;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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YXRhLCBNb2RlbFJlZmVyZW5jZSB9IGZyb20gJ3BsdW1wJztcbmltcG9ydCAqIGFzIEhhcGkgZnJvbSAnaGFwaSc7XG5pbXBvcnQge1xuICBUcmFuc2Zvcm1lcixcbiAgUm91dGVHZW5lcmF0b3IsXG4gIEJhc2ljUm91dGVPcHRpb25zLFxuICBTdHJ1dFJvdXRlQ29uZmlndXJhdGlvbixcbiAgUm91dGVPcHRpb25zLFxuICBTdHJ1dFNlcnZpY2VzLFxufSBmcm9tICcuL2RhdGFUeXBlcyc7XG5cbmZ1bmN0aW9uIGNvbXBvc2UoLi4uZnVuczogVHJhbnNmb3JtZXJbXSkge1xuICByZXR1cm4gKGluaXRpYWw6IFBhcnRpYWw8U3RydXRSb3V0ZUNvbmZpZ3VyYXRpb24+ID0ge30pID0+XG4gICAgZnVucy5yZWR1Y2UoKGFjYywgdikgPT4gdihhY2MpLCBpbml0aWFsKSBhcyBTdHJ1dFJvdXRlQ29uZmlndXJhdGlvbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBsdWdpbihcbiAgZ2VuOiBSb3V0ZUdlbmVyYXRvcixcbiAgcm91dGVPcHRpb25zOiBCYXNpY1JvdXRlT3B0aW9ucyxcbiAgc2VydmljZXM6IFN0cnV0U2VydmljZXMsXG4pIHtcbiAgZnVuY3Rpb24gcChzZXJ2ZXI6IEhhcGkuU2VydmVyLCBfLCBuZXh0KSB7XG4gICAgY29uc3Qgcm91dGVzOiBIYXBpLlJvdXRlQ29uZmlndXJhdGlvbltdID0gW107XG4gICAgWydjcmVhdGUnLCAncmVhZCcsICd1cGRhdGUnLCAnZGVsZXRlJywgJ3F1ZXJ5J10uZm9yRWFjaChhY3Rpb24gPT4ge1xuICAgICAgY29uc3QgbyA9IE9iamVjdC5hc3NpZ24oe30sIHJvdXRlT3B0aW9ucywge1xuICAgICAgICBraW5kOiAnYXR0cmlidXRlcycsXG4gICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgfSkgYXMgUm91dGVPcHRpb25zO1xuICAgICAgcm91dGVzLnB1c2goXG4gICAgICAgIGNvbXBvc2UoXG4gICAgICAgICAgZ2VuLmJhc2Uobywgc2VydmljZXMpLFxuICAgICAgICAgIGdlbi5qb2kobywgc2VydmljZXMpLFxuICAgICAgICAgIGdlbi5hdXRob3JpemUobywgc2VydmljZXMpLFxuICAgICAgICAgIGdlbi5oYW5kbGUobywgc2VydmljZXMpLFxuICAgICAgICApKCksXG4gICAgICApO1xuICAgIH0pO1xuICAgIE9iamVjdC5rZXlzKFxuICAgICAgcm91dGVPcHRpb25zLm1vZGVsLnNjaGVtYS5yZWxhdGlvbnNoaXBzLFxuICAgICkuZm9yRWFjaChyZWxhdGlvbnNoaXAgPT4ge1xuICAgICAgWydjcmVhdGUnLCAncmVhZCcsICd1cGRhdGUnLCAnZGVsZXRlJ10uZm9yRWFjaChhY3Rpb24gPT4ge1xuICAgICAgICBjb25zdCBvID0gT2JqZWN0LmFzc2lnbih7fSwgcm91dGVPcHRpb25zLCB7XG4gICAgICAgICAga2luZDogJ3JlbGF0aW9uc2hpcCcsXG4gICAgICAgICAgYWN0aW9uOiBhY3Rpb24sXG4gICAgICAgICAgcmVsYXRpb25zaGlwOiByZWxhdGlvbnNoaXAsXG4gICAgICAgIH0pIGFzIFJvdXRlT3B0aW9ucztcbiAgICAgICAgcm91dGVzLnB1c2goXG4gICAgICAgICAgY29tcG9zZShcbiAgICAgICAgICAgIGdlbi5iYXNlKG8sIHNlcnZpY2VzKSxcbiAgICAgICAgICAgIGdlbi5qb2kobywgc2VydmljZXMpLFxuICAgICAgICAgICAgZ2VuLmF1dGhvcml6ZShvLCBzZXJ2aWNlcyksXG4gICAgICAgICAgICBnZW4uaGFuZGxlKG8sIHNlcnZpY2VzKSxcbiAgICAgICAgICApKCksXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBzZXJ2ZXIucm91dGUocm91dGVzKTtcbiAgICBuZXh0KCk7XG4gIH1cbiAgcFsnYXR0cmlidXRlcyddID0gT2JqZWN0LmFzc2lnbihcbiAgICB7fSxcbiAgICB7XG4gICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxuICAgICAgbmFtZTogcm91dGVPcHRpb25zLm1vZGVsLnR5cGUsXG4gICAgfSxcbiAgKTtcbiAgcmV0dXJuIHA7XG59XG4iXX0=
